# WeChatServer
A weixin server framwork based flask

----


# 微信公众号服务器
基于flask搭建的微信公众号服务器


#### tools
tools 包用来定义一些工具类或方法
verify：该文件内是用来做认证的装饰器
- isServer：该装饰器用于认证消息是否来自微信服务器


## 工作进度总结
- 2019.6.20 10:20  完成了服务器的基本搭建，公众号与服务器可以正常的绑定与通信
- 2019.6.20 18:25  添加了后台系统模块和api接口模块，功能未明确

## 数据操作接口使用方式
当数据从微信服务器传送过来，服务器自身访问接口对数据进行存储（用户发送的明文消息等）

当发生用户行为，根据不同的用户行为调用不同的接口对数据进行存储。

后台系统可以调用数据接口访问用户交互数据

后台系统在对用户做出数据响应的行为后，追加用户交互数据

后台系统不存在主观意识上的数据修改行为

服务器调用的接口与后台系统调用的接口不能使用相同的接口，以免造成混淆

### api
#### server api
微信公众号服务器获取token等参数的接口，仅通过负责与服务器交互的程序调用，添加验证确保api不被其他用户访问造成token信息泄露
#### back api
微信公众号后台访问的api接口，用于获取历史的用户交互数据或与用户进行交互行为。仅通过微信公众号后台调用，添加用户认证，跟进不同用户来赋予不同的用户权限。管理员具有所有权。

##### menu接口
url：root/api/server/cgi-bin/menu(root为服务器根域)
- post：创建自定义菜单
  - body：官网提供的菜单类型
- delete：删除自定义菜单
- get：查询自定义菜单

##### tags接口
url： root/api/server/cgi-bin/tags(root为服务器根域)
- post：创建标签
  - 参数： name， 标签名
- get：获取标签列表
- put：修改标签
  - 参数： id， 标签id
  - 参数： name， 标签名
- delete：删除标签
  - 参数： id， 标签id

##### user_tags接口

url： root/api/server/cgi-bin/user/tags(root为服务器根域)

- get：获得某个标签下的用户列表或某个用户下的标签列表
  - 参数： tagid， 当url含有tagid参数时为请求标签下的用户列表，此时如果存在openid，则查找某页的用户列表
  - 参数： openid，当url不含有tagid时为请求用户下的标签列表

- put： 批量为用户打标签
  - 参数： openid_list， 需要打标签的用户列表
  - 参数： tagid， 需要被打上的标签id

- delete： 批量为用户取消标签
  - 参数： openid_list， 需要取消标签的用户列表
  - 参数： tagid， 需要被取消的标签id

##### user_remark接口

- put： 为用户添加备注信息
  - 参数： openid， 要添加备注的用户openid
  - 参数： remark， 要添加的备注信息







## wms

后台管理系统。注册用户可以管理微信公众号的部分信息，查看历史交互记录，分析用户行为等等业余。不同用户管理员赋予不同权限则可以进行不同的操作。管理员具有所有权和赋权权限。





### 认证系统

token登录认证

登录后在客户端存入cookie包含用户名和token信息

接口访问要在请求中添加token

